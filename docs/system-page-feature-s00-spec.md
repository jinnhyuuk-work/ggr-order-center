# 시스템 페이지 추가 기능 S-00 스펙 초안

- 문서 버전: `S-00 (초안)`
- 작성일: `2026-02-23`
- 대상 페이지: `system.html`, `assets/js/system.js`, `assets/css/styles.css`
- 목적: 시스템 페이지 추가 기능 2건(타입/섹션 제약, 모듈 모달 정면 미리보기)의 구현 기준을 먼저 고정한다.

## 1. 배경 / 목표

시스템 페이지는 현재 탑뷰 중심의 빌더 UX와 견적 산출 흐름이 구현되어 있으나,
다음 2가지 기능이 추가되면 실제 사용성과 사양 명확성이 크게 올라간다.

1. 타입 선택(`ㅣ자/ㄱ자/ㄷ자/ㅁ자`) + 섹션별 사이즈 입력 + 가용범위 제약
2. 각 모듈 옵션 모달(일반/코너) 내 정면 미리보기(선반갯수, 구성품)

이 문서는 구현 전에 필요한 용어/상태/검증/반영 범위를 합의하기 위한 기준 문서다.

## 2. 범위

### 포함 (이번 작업)

1. 타입 선택 UI/상태
2. 섹션별 사이즈 입력 UI/상태
3. 타입/섹션 제약 검증
4. 메인 미리보기(탑뷰) 반영
5. 모듈 추가/수정 제약 연동
6. 견적 상세 / 주문완료 / 메일 반영
7. 모듈 옵션 모달 정면 미리보기 UI 및 실시간 동기화

### 제외 (후속 가능)

1. 완전 자유형 도면 편집기(드래그 기반)
2. 3D 미리보기
3. 이미지/썸네일 첨부 전송

## 3. 용어 / 라벨 (확정 반영)

### 3.1 사용자 노출 타입 라벨 (확정)

1. `ㅣ자`
2. `ㄱ자`
3. `ㄷ자`
4. `ㅁ자`

### 3.2 내부 키 매핑 (확정 방향)

기존 코드 shape 키 (`assets/js/system.js:44`)를 최대한 재사용한다.

| 사용자 라벨 | 내부 키(권장) | 기존 코드 키 재사용 여부 | 비고 |
|---|---|---|---|
| ㅣ자 | `i_single` | 예 | 기존 존재 |
| ㄱ자 | `l_shape` | 예 | 기존 존재 |
| ㄷ자 | `u_shape` | 예 | 기존 존재 (UI 라벨만 변경) |
| ㅁ자 | `box_shape` | 예 | 기존 존재 |

제거:

- `i_double` (사용하지 않음)

주의:
- 현재 `getSelectedShape()`는 `box_shape`를 고정 반환함 (`assets/js/system.js:281`).
- 타입 선택 UI가 들어가면 이 고정값 제거가 필요함.

## 4. 체크포인트 점검 (필수 반영 범위)

요청하신 체크포인트 1번(`미리보기에 보여야 함`)은 두 기능 모두 `필수`로 처리한다.

아래는 전체 체크포인트 기준 정리(구현 범위 판단용):

| 체크포인트 | 기능 A: 타입/섹션 제약 | 기능 B: 모달 정면 미리보기 | 반영 상태 |
|---|---|---|---|
| 1. 미리보기에 보여야 함 | 필수 (메인 탑뷰) | 필수 (모달 내부 정면뷰) | 이번 작업 포함 |
| 2. 가격에 영향 | 간접/실질 영향 있음 | 보통 없음 (표시용) | A 반영, B는 동기화만 |
| 3. 견적 상세 반영 | 필수에 가까움 | 선택(신규 데이터가 없으면 생략 가능) | A 반영 |
| 4. 주문완료/메일 반영 | 필수 | 신규 데이터 없으면 생략 가능 | A 반영 |
| 5. Undo/Redo 대상 | 권장(영향 큼) | 렌더 자체는 대상 아님 | A는 반영/정책 필요 |
| 6. 비규격/상담 판정 영향 | 필수 | 보통 없음 | A 반영 |

## 5. 기능 A 스펙: 타입 + 섹션 사이즈 + 가용범위 제약

## 5.1 사용자 시나리오

1. 사용자가 시스템 타입(ㅣ/ㄱ/ㄷ/ㅁ)을 선택한다.
2. 타입에 맞는 섹션별 사이즈를 입력한다.
3. 시스템은 입력값의 가용범위를 검사한다.
4. 탑뷰 미리보기에서 타입 윤곽과 섹션 경계/치수를 보여준다.
5. 모듈 추가/수정 시 제약을 넘는 경우 사유를 보여주고 차단하거나 상담안내로 처리한다.

## 5.2 UI 배치 (권장)

- 위치: `stepShape` 영역 상단 (`system.html:71`)
- 순서:
  1. 타입 선택
  2. 섹션별 사이즈 입력
  3. 입력 상태 요약(정상/상담/구성불가)

## 5.3 상태 모델 (초안)

`assets/js/system.js`의 `state` 또는 입력집계 객체에 아래 구조를 포함한다.

```js
// 초안: readCurrentInputs() 반환값 기준으로 포함 권장
{
  layoutType: "i_single" | "l_shape" | "u_shape" | "box_shape",
  sections: [
    {
      id: "s1",
      label: "섹션1",
      length: 1800,      // mm
      depth: 400,        // 기본 고정(확장 여지)
      enabled: true
    }
  ],
  layoutValidation: {
    status: "ok" | "consult" | "invalid",
    messages: [],
    invalidSectionIds: []
  }
}
```

원칙:
- `미리보기`, `견적`, `메일`이 모두 같은 `layoutType + sections`를 읽어야 한다.
- 렌더링용 계산값(좌표/픽셀 변환)은 상태에 저장하지 않고 계산 함수에서 생성한다.

## 5.4 타입별 섹션 구성 정의 (초안)

아래는 UI/검증/미리보기가 공통으로 참조할 타입 정의 테이블이다.

```js
const LAYOUT_TYPE_DEFS = {
  i_single: { label: "ㅣ자", sectionCount: 1, closedLoop: false },
  l_shape:  { label: "ㄱ자", sectionCount: 2, closedLoop: false },
  u_shape:  { label: "ㄷ자", sectionCount: 3, closedLoop: false },
  box_shape:{ label: "ㅁ자", sectionCount: 4, closedLoop: true }
};
```

주의:
- 기존 코드에 `i_double` 키가 있으나 이번 기능 범위에서는 제거 대상이다.

## 5.5 입력 항목 정의 (초안)

### 공통 입력

- 섹션 길이(`mm`) - 필수
- 깊이(`mm`) - 1차는 고정값 400mm 유지, UI 노출 생략 가능

### 타입별 필요 섹션 수

1. `ㅣ자`: 섹션 1개
2. `ㄱ자`: 섹션 2개
3. `ㄷ자`: 섹션 3개
4. `ㅁ자`: 섹션 4개

## 5.6 검증 규칙 (초안)

### A. 필수 입력 검증

1. 타입 미선택 시 `invalid`
2. 타입별 required 섹션 길이 미입력 시 `invalid`

### B. 범위 검증 (섹션 단위)

- 기본 입력 허용 범위: `460mm 이상`
- 입력 상한: 없음 (UI에서 최대값 제한 없음)

상담안내 전환 기준(가격 상담 처리):

1. 한 섹션 길이가 `8000mm 이상`이면 `consult`

결과:
- 범위 밖이지만 상담 가능: `consult`
- 제작 불가 수준: `invalid`

### C. 높이 기준 상담안내 규칙 (확정)

1. 가장 낮은 높이(`space.min`)가 `2700mm 이상`이면 `consult`

주의:
- 위 2개 기준(`섹션 길이 8000 이상`, `가장 낮은 높이 2700 이상`)은 **입력 차단이 아니라 상담안내 가격 처리**로 반영한다.

### D. 구조 검증 (타입 단위)

예시(초안):

1. `ㄱ/ㄷ/ㅁ`는 최소 1개 이상 코너 모듈 또는 코너 연결 가능 구조가 필요할 수 있음
2. `ㅁ자`는 폐루프 총합 최소 길이 기준 필요 가능
3. 타입 변경 후 기존 모듈이 섹션 경계를 침범하면 `invalid` 또는 자동정리 정책 적용

## 5.7 상태 판정 규칙 (필수)

검증 결과는 아래 3단계로 통일한다.

1. `ok` (정상 견적 가능)
2. `consult` (상담 안내 / 견적은 상담형으로 전환)
3. `invalid` (구성 불가 / 진행 차단)

표시 규칙:
- `ok`: 중립/정상 안내
- `consult`: 주황/안내 배지
- `invalid`: 빨강/에러 + 액션 차단

## 5.8 타입 변경 시 동작 정책 (확정 필요)

권장 1차 정책:

1. 타입 변경 시 기존 모듈 구조와 섹션값 초기화
2. 사용자 안내 모달 또는 확인 메시지 표시
3. Undo/Redo로 복구 가능하게 처리 (권장)

이유:
- 자동 재배치는 복잡도와 오류 가능성이 높다.

## 5.9 메인 미리보기 요구사항 (체크포인트 1 반영, 필수)

### 반드시 보여야 하는 요소

1. 선택된 타입의 외곽 형태
2. 섹션 경계 구분선
3. 섹션별 길이 라벨
4. 제약 초과/상담 상태 표시 (색/배지)

### 기존 프리뷰와의 관계

- 기존 모듈 탑뷰/치수 라벨 위에 섹션 레이어를 추가하는 방식 권장
- 섹션 레이어와 모듈 라벨이 겹치면 우선순위 규칙 필요:
  1. 에러/경고 라벨
  2. 섹션 라벨
  3. 모듈 라벨

## 5.10 빌더 제약 연동 요구사항

모듈 추가/수정 시 다음을 체크한다.

1. 추가 위치가 섹션 경계 내인지
2. 섹션 허용 길이 총합을 초과하는지
3. 타입별 코너/폐루프 조건 위반 여부

처리 정책:

1. `invalid`: 추가 버튼 비활성 + 사유 메시지
2. `consult`: 추가 허용 가능하되 가격/요약은 상담 안내로 전환 (정책 확정 필요)

## 5.11 견적 / 주문완료 / 메일 반영 요구사항

### 견적 상세(필수)

예시 출력:

- `타입 ㄷ자`
- `섹션1 1800mm | 섹션2 2400mm | 섹션3 1800mm`
- `레이아웃 상태: 정상` 또는 `비규격 상담 안내`

### 주문완료 상세(필수)

- 타입/섹션 사양 요약을 주문 품목 설명에 포함

### 메일 전송(필수)

- 주문 본문에 타입/섹션값 포함
- 상담 안내 케이스 표시

## 5.12 Undo / Redo 정책 (권장)

영향이 큰 변경 항목은 히스토리 대상에 포함:

1. 타입 변경
2. 섹션 길이 변경

최소 정책:
- 히스토리 미포함 시에도 타입 변경 전 확인 메시지 + 초기화 안내 필수

## 5.13 기능 A 수용 기준 (Acceptance Criteria)

1. 타입을 선택하면 해당 타입에 맞는 섹션 입력 UI가 보인다.
2. 섹션 길이 입력값 변경 시 메인 미리보기가 즉시 갱신된다.
3. 제약 초과 시 상태가 `consult` 또는 `invalid`로 명확히 표시된다.
4. 섹션 길이 `8000mm 이상` 또는 가장 낮은 높이 `2700mm 이상`일 때 상태가 `consult`로 전환된다.
5. `invalid` 상태에서는 진행/추가 액션이 차단된다.
6. 견적 상세/주문완료/메일에 타입/섹션 정보가 포함된다.

## 6. 기능 B 스펙: 모듈 옵션 모달 정면 미리보기 (선반갯수, 구성품)

## 6.1 사용자 시나리오

1. 사용자가 일반 모듈 또는 코너 모듈 옵션 모달을 연다.
2. 선반갯수/옷봉/구성품을 수정한다.
3. 모달 내부 정면 미리보기가 실시간으로 바뀐다.
4. 저장/취소/삭제 시 메인 상태와 일관되게 반영된다.

## 6.2 UI 배치 (권장)

대상 모달:

1. `#bayOptionModal` (`system.html:398`)
2. `#cornerOptionModal` (`system.html:349`)

배치 권장:

1. 입력 폼 상단 또는 우측에 `정면 미리보기 패널`
2. 모바일에서는 입력폼 위로 배치(세로 스택)

## 6.3 표시 요소 (필수/권장)

### 필수

1. 선반 갯수(층 표현)
2. 구성품 상태(예: 옷봉 유무/수량)

### 권장

1. 모듈 타입 배지(일반/코너)
2. 요약 텍스트 (`선반 3개 · 옷봉 1개`)
3. 선택 재질색 반영(가능하면)

## 6.4 데이터 소스 규칙 (매우 중요)

정면 미리보기는 **모달의 현재 draft 값**을 단일 소스로 사용한다.

금지:

- 메인 상태를 따로 읽고 모달 입력을 별도로 계산해 불일치가 나는 구조

권장:

1. 모달 열기 시 draft 초기화
2. 입력 변경 시 draft 갱신
3. 정면 미리보기는 draft만 읽어 렌더

## 6.5 동기화 규칙

### 실시간 갱신

- 선반갯수 변경 -> 즉시 정면 미리보기 반영
- 구성품 변경 -> 즉시 정면 미리보기 반영

### 저장/취소/삭제

1. `적용`: draft -> 실제 상태 반영, 메인 미리보기/견적 갱신
2. `취소`: draft 폐기, 모달 닫기
3. `제거`: 모듈 제거 및 관련 미리보기 초기화

## 6.6 가격/견적/전송 영향 규칙

기본 정책:

- 정면 미리보기는 표시 기능이므로 직접 가격 계산 로직 변경 없음
- 단, 정면 미리보기에서 보여주는 값은 기존 가격/견적 계산과 **반드시 동일 데이터**를 참조해야 함

## 6.7 기능 B 수용 기준 (Acceptance Criteria)

1. 일반 모듈/코너 모듈 모달에 정면 미리보기가 보인다.
2. 선반갯수 변경 시 정면 미리보기가 즉시 갱신된다.
3. 구성품 변경 시 정면 미리보기가 즉시 갱신된다.
4. 저장/취소/삭제 후 메인 상태와 모달 미리보기 결과가 불일치하지 않는다.

## 7. 구현 순서 (S-티켓)

### 기능 A (타입/섹션 제약)

1. `S-01` 상태 모델 확장
2. `S-02` 타입 선택 UI
3. `S-03` 섹션 입력 UI
4. `S-04` 검증 엔진
   - 섹션 최소값 `460`
   - 상담안내 기준: `섹션 길이 >= 8000`, `가장 낮은 높이 >= 2700`
5. `S-05` 메인 미리보기 반영 (체크포인트 1)
6. `S-06` 빌더 제약 연동
7. `S-07` 견적/요약 반영
8. `S-08` 주문완료/메일 반영
9. `S-09` 히스토리 정책 반영

### 기능 B (모달 정면 미리보기)

1. `S-10` 모달 UI 영역 추가
2. `S-11` 정면 미리보기 렌더러 구현
3. `S-12` 모달 입력/저장 흐름 동기화

### QA

1. `S-13` 시스템 페이지 통합 QA

## 8. 오픈 이슈 (구현 시작 전 확정 필요)

1. 타입 변경 시 정책 확정
   - 초기화 + 확인
   - 자동 재배치(후순위 권장)
2. 시스템 기능 A의 UI 세부 구조 확정
   - 타입 선택 UI 형태(카드/세그먼트 버튼)
   - 섹션 입력 레이아웃(가로/세로)

## 9. 구현 전 확인 체크리스트 (짧은 버전)

- [ ] 타입 라벨 목록 확정
- [ ] 섹션 길이 최소값 `460` / 상담기준(`>=8000`) 반영
- [ ] 가장 낮은 높이 상담기준(`>=2700`) 반영
- [ ] 타입 변경 시 초기화 정책 확정
- [ ] 견적/메일 표기 문구 확정
